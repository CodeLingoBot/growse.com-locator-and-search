machine:
  environment:
    JEKYLL_ENV: production

compile:
  override:
    - bundle exec jekyll b
    - bundle exec fpm -s dir -t deb -n growse-com-jekyll --prefix /var/www/ -p _site -a noarch  -v 1.0.0-$CIRCLE_BUILD_NUM _site/=growse-jekyll
test:
  override:
    - echo "Oh yeah!" # No way to test Jekyll. Just do something to satisfy CircleCI.
deployment:
  production:
    branch: jekyll
    commands:
      - bundle exec deb-s3 upload --s3-region=eu-west-1 --bucket apt-growse-com _site/growse-com-jekyll_1.0.0-"$CIRCLE_BUILD_NUM"_all.deb
