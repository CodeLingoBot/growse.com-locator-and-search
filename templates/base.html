{{define "header"}}<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-type" content="text/html"/>
    <meta name="google-site-verification" content="Sr-L2EMmHr-hc4npzb8p1f7zi9ew1Iev84ly519r1p4"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ .Title }} :: growse.com</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-timeago/1.5.4/jquery.timeago.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.7.4/d3.min.js"
            integrity="sha256-b5LQ0B6GDT0kJPBUIDTnS2eJp9XuMaRxkAi2+c07RV4=" crossorigin="anonymous"></script>

    <link rel="dns-prefetch" href="//ajax.googleapis.com">
    <link rel="dns-prefetch" href="//themes.googleusercontent.com">
    <link rel="dns-prefetch" href="//ssl.google-analytics.com">
    <link rel="dns-prefetch" href="//disqus.com">
    <link rel="dns-prefetch" href="//go.disqus.com">
    <link rel="dns-prefetch" href="//a.disquscdn.com">
    <link rel="dns-prefetch" href="//referrer.disqus.com">
    <link rel="shortcut icon" type="image/ico" href="/static/img/favicon.ico"/>
    <link rel="alternate" title="RSS Feed" href="//www.growse.com/rss/" type="application/rss+xml"/>
    <style rel="stylesheet">
        @font-face{font-family:'Open Sans';font-style:normal;font-weight:300;src:local("Open Sans Light"),url(/static/fonts/opensans-300.woff) format("woff")}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;src:local("Open Sans Regular"),url(/static/fonts/opensans-400.woff) format("woff")}@font-face{font-family:Inconsolata;font-style:normal;font-weight:500;src:local("Inconsolata"),url(/static/fonts/inconsolata-500.woff) format("woff")}@font-face{font-family:Andada;font-style:normal;font-weight:400;src:local("Andada"),url(/static/fonts/andada-400.woff) format("woff")}html{font-size:100%}html body{font-size:16px;font-size:1rem;font-family:Andada,Georgia,serif;color:#aaa;padding:0;margin:0;height:100%;text-align:center;background-color:#333;line-height:1.625;-webkit-font-smoothing:antialiased}html body #container{background:#333;text-align:left;vertical-align:middle;margin:0;padding:0}@media screen and (max-width:1023px){html body #container nav{display:none}}@media screen and (min-width:1024px){html body #container nav{overflow:hidden;position:fixed;float:left;width:200px;padding:0;height:100%}html body #container nav ul{list-style-type:none;margin:0;padding:0}html body #container nav ul li{background:#111;-webkit-box-shadow:0 2px 2px rgba(10,10,10,.75);-moz-box-shadow:0 2px 2px rgba(10,10,10,.75);-ms-box-shadow:0 2px 2px rgba(10,10,10,.75);-o-box-shadow:0 2px 2px rgba(10,10,10,.75);box-shadow:0 2px 2px rgba(10,10,10,.75)}html body #container nav ul li a{outline:solid 1;font-family:"Open Sans",Trebuchet,Sans;font-size:.8rem;width:200px;display:table-cell;vertical-align:middle;height:3rem;text-overflow:ellipsis;padding:.2rem 1rem;border-top:1px solid #222}}@media screen and (max-width:767px){html body #container>header{display:none}}@media screen and (min-width:768px){html body #container>header{width:200px;font-weight:400;float:right}html body #container>header div{text-align:center;margin:1em}html body #container>header h1{text-align:center}html body #container>header h1 a{font-weight:400;font-family:"Open Sans",Trebuchet,Sans;text-align:center;color:#f90}html body #container>header h2{text-align:center;font-family:Andada,Georgia,serif;font-size:1rem;font-weight:300;line-height:1rem}html body #container>header p{font-size:.7rem;text-align:center}html body #container>header fieldset{border:0}html body #container>header fieldset input{padding:.5em;background-color:#333;width:10em}html body #container>header input#searchbox{font-family:"Open Sans",Trebuchet,Sans;border-width:0 1px 1px;outline:0}html body #container>header #previous{text-align:left}html body #container>header #previous ul#previousyears{list-style-type:none;font-size:.8rem;margin:0 0 0 1rem;padding:0;font-family:"Open Sans",Trebuchet,Sans}html body #container>header #previous ul#previousyears li.year{margin:.2rem 0 0;line-height:.8}html body #container>header #previous ul#previousyears li.year:before{content:"";border-color:transparent #f90;border-style:solid;border-width:.35rem 0 .35rem .45rem;display:block;height:0;width:0;left:-1rem;top:.9rem;position:relative}html body #container>header #previous ul#previousyears ul{display:none;list-style-type:none;margin:.5rem 0 0 .4rem;padding:0}html body #container>header #previous ul#previousyears ul li{margin:0}html body #container #location p{font-family:"Open Sans",Trebuchet,Sans;font-size:.5rem}}html body #container #content{background-color:#222;height:100%}html body #container #content.admin{height:100%}html body #container #content.admin .hide{display:none}html body #container #content.admin ul{padding:0}html body #container #content.admin ul li{list-style:none;margin:0;padding:0}html body #container #content.admin #newarticlemodal{position:fixed;width:100%;height:100%;left:0;top:0;background:linear-gradient(-45deg,#262626 25%,transparent 25%,transparent 50%,#262626 50%,#262626 75%,transparent 75%,transparent) #333;background-size:40px 40px}html body #container #content.admin #newarticlemodal form#newarticle{background:#222;margin:2rem;padding:1rem;height:100%}html body #container #content.admin #newarticlemodal form#newarticle div.expand{height:80%;padding:0;margin:0}html body #container #content.admin #newarticlemodal form#newarticle div.expand textarea{padding:.5rem;width:49%;height:100%;box-sizing:border-box;background-color:#222;border:1px solid #333;font-family:"Open Sans",Trebuchet,Sans;color:#aaa}html body #container #content.admin #newarticlemodal form#newarticle div#preview{border:1px solid #333;float:right;display:block;width:49%;height:90%;overflow:auto}html body #container #content.admin #newarticlemodal form#newarticle div{padding:0;margin:0}html body #container #content.admin #newarticlemodal form#newarticle div input[type=text]{box-sizing:border-box;padding:.5rem;width:49%}html body #container #content.nonav{margin-left:0}@media screen and (max-width:767px){html body #container #content{margin:0;padding:.5rem 1rem}}@media screen and (min-width:768px) and (max-width:1023px){html body #container #content{margin:0 200px 0 0}}@media screen and (min-width:1024px){html body #container #content{margin:0 200px}}html body #container #content article header{width:auto;height:auto;float:none;background:0 0;min-height:5rem}@media screen and (max-width:767px){html body #container #content article header h1{text-align:left;font-family:"Open Sans",Trebuchet,Sans;margin:0 0 .5rem;font-size:2rem;color:#f90;font-weight:100}html body #container #content article header time.fancy{display:none}html body #container #content article header time.plain{display:block;font-size:.7rem}}@media screen and (min-width:768px){html body #container #content{padding:2rem}html body #container #content article header h1{text-align:left;font-family:"Open Sans",Trebuchet,Sans;margin:0 0 1rem;font-size:2.5rem;color:#f90;font-weight:300}html body #container #content article header time.plain{display:none}html body #container #content article header time.fancy{display:block;margin:0 0 1rem 1rem;float:right;width:5rem;height:4rem}html body #container #content article header time.fancy p{-webkit-box-shadow:0 0 6px rgba(0,0,0,.3);-moz-box-shadow:0 0 6px rgba(0,0,0,.3);-ms-box-shadow:0 0 6px rgba(0,0,0,.3);-o-box-shadow:0 0 6px rgba(0,0,0,.3);box-shadow:0 0 6px rgba(0,0,0,.3);background:#333;font-size:1rem;font-size:16px;font-weight:400;font-family:"Open Sans",Trebuchet,Sans;text-align:center;color:#aaa;text-transform:uppercase;line-height:1.5;margin:0;padding:0;border-radius:5px}html body #container #content article header time.fancy p span{color:#aaa;background:#444;font-size:1.2rem;line-height:1.2;font-weight:700;display:block;padding:0}html body #container #content article header time.fancy p span.year{border-radius:0 0 5px 5px;font-size:.85rem;line-height:15px;background:#333;color:#aaa;padding:3px 0;font-weight:400}}html body #container #content article code,html body #container #content article pre code{border:1px solid #556;font-family:Inconsolata,monospace;background:#223}html body #container #content article img{max-width:100%}html body #container #content article pre code{font-size:.8rem;line-height:1;white-space:pre;overflow:auto;padding:5px;display:block;margin:1em 0}html body #container #content article code{padding:2px}html body #container #content article h2,html body #container input{font-family:"Open Sans",Trebuchet,Sans}html body #container #content article section{line-height:1.6em}html body #container #content #searchresults nav #paginator{float:right}html body #container #content #searchresults ul{padding:0}html body #container #content #searchresults ul .searchresult{padding:0;margin:0 0 4rem}html body #container #content #searchresults ul .searchresult header{min-height:0}html body #container #content #searchresults ul .searchresult header time{float:right;width:auto;height:auto;font-size:.7rem}html body #container #content #searchresults ul .searchresult header h2{font-weight:400;text-align:left;font-size:1.5rem}html body #container #content #searchresults ul .searchresult span.highlight{font-weight:700}html body #container a{text-decoration:none;color:#57d}html body #container a img,html body #container iframe{border:0}html body #container p{margin:.5rem 0}html body #container input{margin:0;padding:2px;color:#aaa;font-size:.8rem;border:1px solid #666;background:#222}html body #container footer{font-size:.8rem;background-color:#333;padding:10px;text-align:right}html body #container .right{float:right}html body #container .left{float:left}html body #container .hohoho{display:none}html body #container .centertext{text-align:center}html body #container .clear{clear:both}html body #container .prop{float:right;width:1px;min-height:313px;height:313px}html body #container .clear_prop{clear:both;height:1px;overflow:hidden}html body #container .sparkline{fill:none;stroke:#57d;stroke-width:1.5px}html body #container .axis line,html body #container .axis path{fill:none;stroke:#aaa;shape-rendering:crispEdges}html body #container .axis text,html body #container .axislabel{fill:#aaa;font-family:sans-serif;font-size:11px}html body #container .nano>.nano-pane{background:#333;-webkit-border-radius:0;border-radius:0}html body #container .nano>.nano-slider{background:#fff}.here{background-color:#222;border:0}.hljs{display:block;overflow-x:auto;padding:.5em;background:#002b36;color:#839496;-webkit-text-size-adjust:none}.diff .hljs-header,.hljs-comment,.hljs-doctype,.hljs-javadoc,.hljs-pi,.lisp .hljs-string{color:#586e75}.css .hljs-tag,.hljs-addition,.hljs-keyword,.hljs-request,.hljs-status,.hljs-winutils,.method,.nginx .hljs-title{color:#859900}.hljs-command,.hljs-dartdoc,.hljs-hexcolor,.hljs-link_url,.hljs-number,.hljs-phpdoc,.hljs-regexp,.hljs-rules .hljs-value,.hljs-string,.hljs-tag .hljs-value,.tex .hljs-formula{color:#2aa198}.css .hljs-function,.hljs-built_in,.hljs-chunk,.hljs-decorator,.hljs-id,.hljs-identifier,.hljs-localvars,.hljs-title,.vhdl .hljs-literal{color:#268bd2}.hljs-attribute,.hljs-class .hljs-title,.hljs-constant,.hljs-link_reference,.hljs-parent,.hljs-type,.hljs-variable,.lisp .hljs-body,.smalltalk .hljs-number{color:#b58900}.css .hljs-pseudo,.diff .hljs-change,.hljs-attr_selector,.hljs-cdata,.hljs-header,.hljs-pragma,.hljs-preprocessor,.hljs-preprocessor .hljs-keyword,.hljs-shebang,.hljs-special,.hljs-subst,.hljs-symbol,.hljs-symbol .hljs-string{color:#cb4b16}.hljs-deletion,.hljs-important{color:#dc322f}.hljs-link_label{color:#6c71c4}.tex .hljs-formula{background:#073642}.nano{position:relative;width:100%;height:100%;overflow:hidden}.nano>.nano-content,.nano>.nano-pane{position:absolute;right:0;top:0;bottom:0}.nano>.nano-content{overflow:scroll;overflow-x:hidden;left:0}.nano>.nano-content:focus{outline:dotted thin}.nano>.nano-content::-webkit-scrollbar{display:none}.has-scrollbar>.nano-content::-webkit-scrollbar{display:block}.nano>.nano-pane{background:rgba(0,0,0,.25);width:10px;visibility:hidden\9;opacity:.01;-webkit-transition:.2s;-moz-transition:.2s;-o-transition:.2s;transition:.2s;-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px}.nano>.nano-pane>.nano-slider{background:#444;background:rgba(0,0,0,.5);position:relative;margin:0 1px;-moz-border-radius:3px;-webkit-border-radius:3px;border-radius:3px}.nano-pane.active,.nano-pane.flashed,.nano:hover>.nano-pane{visibility:visible\9;opacity:.99}
    </style>
</head>
<body>
<div id="container" itemtype="http://schema.org/Blog" itemscope>
    <header>
        <h1 id="titletext"><a href="/" title="Home">growse.com</a></h1>

        <h2 id="about">I write things here.</h2>

        <div id="search">
            <form action="/search/" method="post">
                <fieldset>
                    <input placeholder="Search for things" id="searchbox" type="text" name="a" class="searchtext"/>
                </fieldset>
            </form>
        </div>

        <p>I'm on <a href="https://keybase.io/growse" title="Keybase">Keybase</a>.</p>

        {{if .Months}}
        <div id="previous">
            <h2>Previous things</h2>
            <ul id="previousyears">
                {{range $index, $element := .Months}}
                {{if $element.FirstOfTheYear}}
                {{if ne $index 0}}
            </ul>
            {{end}}
            <li class="year">
                <a href="#">{{$element.Year}}</a>
            </li>
            <ul id="{{$element.Year}}" class="hide">
                {{end}}
                <li><a href="/{{$element.Year}}/{{printf " %02d" $element.Month}}/"
                    title="{{printf "%02d" $element.Month}} {{$element.Year}} ({{$element.Count}})">
                    {{$element.Month.String}}</a>
                    ({{$element.Count}})
                </li>
                {{end}}
            </ul>
        </div>
        {{end}}
        <div id="location">
            {{if .LastLocation}}
            <p>Last seen floating around near <a
                    href="http://maps.google.com/?q={{ printf " %.2f" .LastLocation.Latitude }},{{printf "%.2f" .LastLocation.Longitude }}">
                {{ .LastLocation.Name }}</a>. {{ RenderFloat "#,###.##" .TotalDistance }} miles this year.
            </p>
            {{end}}
        </div>
    </header>
    {{if .Index}}
    <nav class="nano">
        <ul id="articlenav" class="nano-content">
            {{ range .Index }}
            <li data-datestamp="{{ .Timestamp.UTC}}" data-id="{{ .Id }}">
                <a href="{{.GetAbsoluteUrl}}" title="{{ .Title }}" {{if eq $.Article.Id .Id}}class="here" {{end}}><span>{{ .Title }}</span></a>
            </li>
            {{ end }}
        </ul>
    </nav>
    {{ end }}

    {{end}}
    {{define "footer"}}
    <footer>
        Almost everything (c) 2002-{{ .CurrentYear }} <a rel="author" itemprop="author"
                                                         href="https://plus.google.com/+AndrewRowson">Andrew
        Rowson</a>. If you break anything because of something you read here, that's your own problem.
    </footer>
</div>

<script type="text/javascript">
    !function(){function t(n,t){function r(t){var r,e=n.arcs[0>t?~t:t],o=e[0];return n.transform?(r=[0,0],e.forEach(function(n){r[0]+=n[0],r[1]+=n[1]})):r=e[e.length-1],0>t?[r,o]:[o,r]}function e(n,t){for(var r in n){var e=n[r];delete t[e.start],delete e.start,delete e.end,e.forEach(function(n){o[0>n?~n:n]=1}),f.push(e)}}var o={},i={},u={},f=[],c=-1;return t.forEach(function(r,e){var o,i=n.arcs[0>r?~r:r];i.length<3&&!i[1][0]&&!i[1][1]&&(o=t[++c],t[c]=r,t[e]=o)}),t.forEach(function(n){var t,e,o=r(n),f=o[0],c=o[1];if(t=u[f])if(delete u[t.end],t.push(n),t.end=c,e=i[c]){delete i[e.start];var a=e===t?t:t.concat(e);i[a.start=t.start]=u[a.end=e.end]=a}else i[t.start]=u[t.end]=t;else if(t=i[c])if(delete i[t.start],t.unshift(n),t.start=f,e=u[f]){delete u[e.end];var s=e===t?t:e.concat(t);i[s.start=e.start]=u[s.end=t.end]=s}else i[t.start]=u[t.end]=t;else t=[n],i[t.start=f]=u[t.end=c]=t}),e(u,i),e(i,u),t.forEach(function(n){o[0>n?~n:n]||f.push([n])}),f}function r(n,r,e){function o(n){var t=0>n?~n:n;(s[t]||(s[t]=[])).push({i:n,g:a})}function i(n){n.forEach(o)}function u(n){n.forEach(i)}function f(n){"GeometryCollection"===n.type?n.geometries.forEach(f):n.type in l&&(a=n,l[n.type](n.arcs))}var c=[];if(arguments.length>1){var a,s=[],l={LineString:i,MultiLineString:u,Polygon:u,MultiPolygon:function(n){n.forEach(u)}};f(r),s.forEach(arguments.length<3?function(n){c.push(n[0].i)}:function(n){e(n[0].g,n[n.length-1].g)&&c.push(n[0].i)})}else for(var h=0,p=n.arcs.length;p>h;++h)c.push(h);return{type:"MultiLineString",arcs:t(n,c)}}function e(r,e){function o(n){n.forEach(function(t){t.forEach(function(t){(f[t=0>t?~t:t]||(f[t]=[])).push(n)})}),c.push(n)}function i(n){return l(u(r,{type:"Polygon",arcs:[n]}).coordinates[0])>0}var f={},c=[],a=[];return e.forEach(function(n){"Polygon"===n.type?o(n.arcs):"MultiPolygon"===n.type&&n.arcs.forEach(o)}),c.forEach(function(n){if(!n._){var t=[],r=[n];for(n._=1,a.push(t);n=r.pop();)t.push(n),n.forEach(function(n){n.forEach(function(n){f[0>n?~n:n].forEach(function(n){n._||(n._=1,r.push(n))})})})}}),c.forEach(function(n){delete n._}),{type:"MultiPolygon",arcs:a.map(function(e){var o=[];if(e.forEach(function(n){n.forEach(function(n){n.forEach(function(n){f[0>n?~n:n].length<2&&o.push(n)})})}),o=t(r,o),(n=o.length)>1)for(var u,c=i(e[0][0]),a=0;n>a;++a)if(c===i(o[a])){u=o[0],o[0]=o[a],o[a]=u;break}return o})}}function o(n,t){return"GeometryCollection"===t.type?{type:"FeatureCollection",features:t.geometries.map(function(t){return i(n,t)})}:i(n,t)}function i(n,t){var r={type:"Feature",id:t.id,properties:t.properties||{},geometry:u(n,t)};return null==t.id&&delete r.id,r}function u(n,t){function r(n,t){t.length&&t.pop();for(var r,e=s[0>n?~n:n],o=0,i=e.length;i>o;++o)t.push(r=e[o].slice()),a(r,o);0>n&&f(t,i)}function e(n){return n=n.slice(),a(n,0),n}function o(n){for(var t=[],e=0,o=n.length;o>e;++e)r(n[e],t);return t.length<2&&t.push(t[0].slice()),t}function i(n){for(var t=o(n);t.length<4;)t.push(t[0].slice());return t}function u(n){return n.map(i)}function c(n){var t=n.type;return"GeometryCollection"===t?{type:t,geometries:n.geometries.map(c)}:t in l?{type:t,coordinates:l[t](n)}:null}var a=v(n.transform),s=n.arcs,l={Point:function(n){return e(n.coordinates)},MultiPoint:function(n){return n.coordinates.map(e)},LineString:function(n){return o(n.arcs)},MultiLineString:function(n){return n.arcs.map(o)},Polygon:function(n){return u(n.arcs)},MultiPolygon:function(n){return n.arcs.map(u)}};return c(t)}function f(n,t){for(var r,e=n.length,o=e-t;o<--e;)r=n[o],n[o++]=n[e],n[e]=r}function c(n,t){for(var r=0,e=n.length;e>r;){var o=r+e>>>1;n[o]<t?r=o+1:e=o}return r}function a(n){function t(n,t){n.forEach(function(n){0>n&&(n=~n);var r=o[n];r?r.push(t):o[n]=[t]})}function r(n,r){n.forEach(function(n){t(n,r)})}function e(n,t){"GeometryCollection"===n.type?n.geometries.forEach(function(n){e(n,t)}):n.type in u&&u[n.type](n.arcs,t)}var o={},i=n.map(function(){return[]}),u={LineString:t,MultiLineString:r,Polygon:r,MultiPolygon:function(n,t){n.forEach(function(n){r(n,t)})}};n.forEach(e);for(var f in o)for(var a=o[f],s=a.length,l=0;s>l;++l)for(var h=l+1;s>h;++h){var p,g=a[l],v=a[h];(p=i[g])[f=c(p,v)]!==v&&p.splice(f,0,v),(p=i[v])[f=c(p,g)]!==g&&p.splice(f,0,g)}return i}function s(n,t){function r(n){i.remove(n),n[1][2]=t(n),i.push(n)}var e=v(n.transform),o=m(n.transform),i=g();return t||(t=h),n.arcs.forEach(function(n){for(var u,f,c=[],a=0,s=0,l=n.length;l>s;++s)f=n[s],e(n[s]=[f[0],f[1],1/0],s);for(var s=1,l=n.length-1;l>s;++s)u=n.slice(s-1,s+2),u[1][2]=t(u),c.push(u),i.push(u);for(var s=0,l=c.length;l>s;++s)u=c[s],u.previous=c[s-1],u.next=c[s+1];for(;u=i.pop();){var h=u.previous,p=u.next;u[1][2]<a?u[1][2]=a:a=u[1][2],h&&(h.next=p,h[2]=u[2],r(h)),p&&(p.previous=h,p[0]=u[0],r(p))}n.forEach(o)}),n}function l(n){for(var t,r=-1,e=n.length,o=n[e-1],i=0;++r<e;)t=o,o=n[r],i+=t[0]*o[1]-t[1]*o[0];return.5*i}function h(n){var t=n[0],r=n[1],e=n[2];return Math.abs((t[0]-e[0])*(r[1]-t[1])-(t[0]-r[0])*(e[1]-t[1]))}function p(n,t){return n[1][2]-t[1][2]}function g(){function n(n,t){for(;t>0;){var r=(t+1>>1)-1,o=e[r];if(p(n,o)>=0)break;e[o._=t]=o,e[n._=t=r]=n}}function t(n,t){for(;;){var r=t+1<<1,i=r-1,u=t,f=e[u];if(o>i&&p(e[i],f)<0&&(f=e[u=i]),o>r&&p(e[r],f)<0&&(f=e[u=r]),u===t)break;e[f._=t]=f,e[n._=t=u]=n}}var r={},e=[],o=0;return r.push=function(t){return n(e[t._=o]=t,o++),o},r.pop=function(){if(!(0>=o)){var n,r=e[0];return--o>0&&(n=e[o],t(e[n._=0]=n,0)),r}},r.remove=function(r){var i,u=r._;if(e[u]===r)return u!==--o&&(i=e[o],(p(i,r)<0?n:t)(e[i._=u]=i,u)),u},r}function v(n){if(!n)return y;var t,r,e=n.scale[0],o=n.scale[1],i=n.translate[0],u=n.translate[1];return function(n,f){f||(t=r=0),n[0]=(t+=n[0])*e+i,n[1]=(r+=n[1])*o+u}}function m(n){if(!n)return y;var t,r,e=n.scale[0],o=n.scale[1],i=n.translate[0],u=n.translate[1];return function(n,f){f||(t=r=0);var c=(n[0]-i)/e|0,a=(n[1]-u)/o|0;n[0]=c-t,n[1]=a-r,t=c,r=a}}function y(){}var d={version:"1.6.18",mesh:function(n){return u(n,r.apply(this,arguments))},meshArcs:r,merge:function(n){return u(n,e.apply(this,arguments))},mergeArcs:e,feature:o,neighbors:a,presimplify:s};"function"==typeof define&&define.amd?define(d):"object"==typeof module&&module.exports?module.exports=d:this.topojson=d}();
</script>
<script type="text/javascript">
    $(function () {
        // Year expanding functionality
        $("li.year>a").click(function () {
            $(this).parent().next().slideToggle(100);
            return false;
        });
        //Scroll the left nav to the right point.
        if ($('.here').length > 0) {
            var percentagedown = ($('.here').position().top / $(window).height()) * 100;
            if (percentagedown > 50) {
                var value = $('.here').position().top - ($(window).height() / 2) + ($('nav ul li:first').height() / 2);
                $(".nano").nanoScroller({
                    scrollTop: value
                });
            } else {
                $(".nano").nanoScroller();
            }
        }
        $('time.timeago').timeago();
        $('button.svgsave').on('click', function () {
            var html = d3.select("svg")
                .attr("version", 1.1)
                .attr("xmlns", "http://www.w3.org/2000/svg")
                .node().parentNode.innerHTML;

            //console.log(html);
            var imgsrc = 'data:image/svg+xml;base64,' + btoa(html);
            var img = '<img src="' + imgsrc + '">';
            d3.select("#svgdataurl").html(img);


            var canvas = document.querySelector("canvas"),
                context = canvas.getContext("2d");

            var image = new Image();
            image.src = imgsrc;
            image.onload = function () {
                context.drawImage(image, 0, 0);

                var canvasdata = canvas.toDataURL("image/png");

                var pngimg = '<img src="' + canvasdata + '">';
                d3.select("#pngdataurl").html(pngimg);

                var a = document.createElement("a");
                a.download = "sample.png";
                a.href = canvasdata;
                a.click();
            };
        });
        $(document).keyup(function (e) {
            if (e.keyCode == 27) { // escape key maps to keycode `27`
                growse.clearForm();
            }
        });
    });

    var growse = {
        map: {
            width: 816,
            height: 480,
            svg: null,
            path: null,
            zoom: null,
            move: function () {
                var g = growse.map.svg.select('.mapgroup');
                var t = d3.event.translate;
                var s = d3.event.scale;
                growse.map.zoom.translate(t);
                g.attr("transform", "translate(" + t + ")scale(" + s + ")");
                d3.selectAll(".route path").style("stroke-width", (1.5 / s) + "px");

            }
        },
        projection: null,
        mapFeature: null,
        drawMap: function (elemId, mapfile) {
            $('select[name=year]').on('change', function () {
                console.log($(this).val());
                growse.drawRoute($(this).val());
            });
            //Initial dimensions
            //Set up the map projection
            growse.projection = d3.geo.equirectangular()
                .center([0, 0])
                .scale(140)
                .translate([growse.map.width / 2, growse.map.height / 2])
                .precision(0.1);

            //Turn the projection into a path
            growse.map.path = d3.geo.path()
                .projection(growse.projection);

            growse.map.zoom = d3.behavior.zoom()
                .scaleExtent([1, 500])
                .on("zoom", growse.map.move);
            growse.map.svg = d3.select(elemId).append("svg")
                .attr("width", growse.map.width)
                .attr("height", growse.map.height)
                .call(growse.map.zoom);

            d3.json(mapfile, function (error, world) {
                var g = growse.map.svg.append('g').attr('class', 'mapgroup');
                g.append("path")
                    .datum(topojson.feature(world, world.objects.land))
                    .attr("class", "land")
                    .attr("d", growse.map.path)
                    .style("fill", "#57d");
                growse.drawRoute($("select[name=year]").val());

            });

            d3.select(self.frameElement).style("height", growse.map.height + "px");
            d3.select(self.frameElement).style("width", growse.map.width + "px");

        },
        drawRoute: function (year) {
            var g = growse.map.svg.select(".mapgroup");
            d3.selectAll(".route").remove();
            d3.json("linestring/" + year + "/", function (error, mypath) {
                //Add the path
                g.append("g")
                    .attr("class", "route")
                    .selectAll("path")
                    .data(mypath.features)
                    .enter()
                    .append("path")
                    .attr("d", growse.map.path)
                    .style("fill-opacity", "0.0")
                    .style("fill", "#000")
                    .style("stroke", "#f90")
                    .style("stroke-width", "1px");

                /*
                 var targetPath = d3.selectAll('.route')[0][0];
                 var pathNode = d3.select(targetPath).selectAll('path').node();
                 var pathLength = pathNode.getTotalLength();
                 d3.select('.route')
                 .style('stroke-dasharray', pathLength)
                 .style('stroke-dashoffset', 0)
                 .style('-webkit-animation', "flarble 60s linear forwards");*/
            });
        },
        drawLineChart: function (elemId, data, width, height, xAxisTitle, yAxisTitle) {
            var xpadding = 45;
            var ypadding = 15;
            if (!data) {
                return;
            }
            //var x = d3.scale.linear().range([0, width]);
            var x = d3.time.scale().range([xpadding, width - (xpadding * 2)]);
            var y = d3.scale.linear().range([height - (ypadding * 2), ypadding]);
            var line = d3.svg.line()
                .interpolate("basis")
                .x(function (d) {
                    return x(d.date);
                })
                .y(function (d) {
                    return y(d.val);
                });
            data.forEach(function (d) {
                d.date = new Date(d[0] * 1000);
                d.val = d[1];
            });
            x.domain(d3.extent(data, function (d) {
                return d.date;
            }));
            y.domain(d3.extent(data, function (d) {
                return d.val;
            }));
            var e = d3.select(elemId);
            var svg = e.append('svg');
            svg.attr('width', width)
                .attr('height', height)
                .append('path')
                .datum(data)
                .attr('class', 'sparkline')
                .attr('d', line);
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(0," + (height - ypadding - ypadding) + ")")
                .call(d3.svg.axis()
                    .scale(x)
                    .orient("bottom"));
            svg.append("g")
                .attr("class", "axis")
                .attr("transform", "translate(" + xpadding + ",0)")
                .call(d3.svg.axis()
                    .scale(y)
                    .orient("left")
                    .ticks(5));
            if (yAxisTitle) {
                svg.append("text")
                    .attr("transform", "translate(" + xpadding / 2 + "," + height / 2 + ") rotate(270) ")
                    .attr('class', 'axislabel')
                    .text(yAxisTitle);
            }

        }
    };
</script>
</body>
</html>{{end}}